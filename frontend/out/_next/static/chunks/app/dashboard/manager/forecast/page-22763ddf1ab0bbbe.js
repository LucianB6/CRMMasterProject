(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9183],{3998:(e,r,t)=>{"use strict";t.d(r,{$:()=>d});var a=t(95155),n=t(12115),s=t(17129),i=t(92885),l=t(64269);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,r)=>{let{className:t,variant:n,size:i,asChild:d=!1,...c}=e,u=d?s.DX:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:n,size:i,className:t})),ref:r,...c})});d.displayName="Button"},7216:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>P});var a=t(95155),n=t(12115),s=t(26265),i=t(27105),l=t(68425),o=t(47734),d=t(73697),c=t(33420),u=t(37665),m=t(73804),f=t(35299),p=t(3007),h=t(95740),g=t(1524),x=t(86948),v=t(3998),b=t(11647),y=t(64269),j=t(76444),N=t(65142),w=t(90960);let z="forecast_rf",_=e=>e.toISOString().slice(0,10),S=(e,r)=>{let t=new Date(e);return t.setMonth(t.getMonth()+r),t},C=()=>_(S(new Date,-6)),k=e=>new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON",maximumFractionDigits:0}).format(e),R=e=>{let r=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e);if(r){let e=Number(r[1]);return new Date(Date.UTC(e,Number(r[2])-1,Number(r[3]))).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",year:"numeric",timeZone:"UTC"})}return new Date(e).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",year:"numeric"})},D=(e,r)=>{let t=new Date(e);return Math.floor((new Date(r).getTime()-t.getTime())/864e5)+1};function P(){var e,r,t;let[P,A]=(0,n.useState)(!0),[L,T]=(0,n.useState)(!1),[E,B]=(0,n.useState)([]),[F,O]=(0,n.useState)([]),[Z,I]=(0,n.useState)(null),[V,M]=(0,n.useState)(""),[U,W]=(0,n.useState)(C),[J,G]=(0,n.useState)(()=>_(new Date)),[$,H]=(0,n.useState)(()=>_(new Date)),[K,X]=(0,n.useState)(()=>_(S(new Date,6))),[q,Q]=(0,n.useState)(null),Y=(0,n.useCallback)(()=>window.localStorage.getItem("salesway_token"),[]),ee=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=Y();return{...e?{"Content-Type":"application/json"}:{},...r?{Authorization:"Bearer ".concat(r)}:{}}},[Y]),er=e=>{if(e instanceof w.hD){if(404===e.status)return"Resursa nu a fost găsită (404).";if(403===e.status){var r;return(null!=(r=e.body)?r:"").toLowerCase().includes("no eligible membership")?"Nu există un membership activ pentru companie. Contactează administratorul.":"Acces interzis (403). Verifică autentificarea."}return 409===e.status?"Conflict la salvare (409). Verifică dacă modelul există deja.":e.status>=500?"Serverul a \xeent\xe2mpinat o eroare. \xcencearcă din nou mai t\xe2rziu.":e.message}return e instanceof Error?e.message.toLowerCase().includes("failed to fetch")?"Nu am putut contacta serverul ML. Verifică conexiunea și configurarea API.":e.message:"Eroare necunoscută"},et=(0,n.useCallback)(async()=>{let e=await (0,w.nr)("/ml/models",{headers:ee()});return B(e),e.length>0&&M(r=>r||e[0].id),e},[ee]);(0,n.useCallback)(async e=>{var r;let t=new URLSearchParams({horizon_days:String(30)});e&&t.set("prediction_date",e);let a=null!=(r=(await (0,w.nr)("/ml/predictions/latest?".concat(t.toString()),{headers:ee()}))[0])?r:null;return I(a),a&&M(a.model_id),a},[ee]);let ea=(0,n.useCallback)(async(e,r,t)=>{let a=new URLSearchParams({model_id:e,horizon_days:String(1),from:r,to:t});O(await (0,w.nr)("/ml/predictions?".concat(a.toString()),{headers:ee()}))},[ee]),en=(0,n.useCallback)(async()=>{let e=new URLSearchParams({status:"ACTIVE",name:z}),r=await (0,w.nr)("/ml/models?".concat(e.toString()),{headers:ee()});if(0===r.length)throw Error("Nu există un model activ disponibil.");return[...r].sort((e,r)=>{var t,a;return(null!=(t=r.trained_at)?t:"").localeCompare(null!=(a=e.trained_at)?a:"")})[0]},[ee]),es=(0,n.useCallback)(e=>{let r=e.filter(e=>"ACTIVE"===e.status);return 0===r.length?null:[...r].sort((e,r)=>{var t,a;return(null!=(t=r.trained_at)?t:"").localeCompare(null!=(a=e.trained_at)?a:"")})[0]},[]);(0,n.useCallback)(async(e,r,t)=>{await ea(e,r,t)},[ea]);let ei=(0,n.useCallback)(async()=>{if(A(!0),Q(null),!Y()){Q("Nu ești autentificat. Conectează-te pentru a vedea prognozele."),A(!1);return}try{let e=await et(),r=es(e);r&&M(r.id)}catch(e){Q(er(e))}finally{A(!1)}},[et,es,Y]);(0,n.useEffect)(()=>{ei()},[ei]);let el=async()=>{Q(null);let e=Y();if(!e)return void Q("Nu ești autentificat. Conectează-te și \xeencearcă din nou.");if(!$||!K)return void Q("Selectează intervalul prognozei.");if(new Date($)>new Date(K))return void Q("Data de \xeenceput trebuie să fie \xeenainte de data de final.");let r=D($,K);if(r>360)return void Q("Intervalul selectat depășește orizontul permis de ".concat(360," zile."));T(!0);try{let t;if(console.info("[forecast] generate: inputs",{train_from:U,train_to:J,forecast_from:$,forecast_to:K,selected_days:r}),!U||!J)return void Q("Selectează intervalul de training.");if(new Date(U)>new Date(J))return void Q("Data de \xeenceput trebuie să fie \xeenainte de data de final.");try{t=await (0,w.nr)("/ml/models/train",{method:"POST",headers:{...ee(!0),Authorization:"Bearer ".concat(e)},body:JSON.stringify({name:z,version:"v1",horizon_days:30,train_from:U,train_to:J})})}catch(e){if(e instanceof w.hD&&409===e.status)t=await en();else throw e}B(e=>{let r=e.findIndex(e=>e.id===t.id);if(-1===r)return[t,...e];let a=[...e];return a[r]=t,a}),M(t.id);let a=await (0,w.nr)("/ml/predictions/refresh",{method:"POST",headers:{...ee(!0),Authorization:"Bearer ".concat(e)},body:JSON.stringify({model_id:t.id,prediction_date:$,horizon_days:r})}),n=a.find(e=>30===e.horizon_days),s=a.filter(e=>1===e.horizon_days).sort((e,r)=>e.prediction_date.localeCompare(r.prediction_date));I(null!=n?n:null),O(s)}catch(e){e instanceof w.hD?console.error("[forecast] refresh error",{status:e.status,body:e.body,message:e.message}):console.error("[forecast] refresh error",e),Q(er(e))}finally{T(!1)}},eo=(0,n.useMemo)(()=>F.length>0?F.length:(null==Z?void 0:Z.horizon_days)?Z.horizon_days:$&&K?D($,K):30,[null==Z?void 0:Z.horizon_days,F.length,$,K]),ed=(0,n.useMemo)(()=>{var e,r,t,a,n,s,i;if(0===F.length&&!Z)return null;let l=[...F].sort((e,r)=>e.prediction_date.localeCompare(r.prediction_date)),o=Z?Number(null!=(t=Z.predicted_revenue)?t:0):l.reduce((e,r)=>{var t;return e+Number(null!=(t=r.predicted_revenue)?t:0)},0),d=E.find(e=>e.id===V),c=null!=(a=null==(e=l[0])?void 0:e.prediction_date)?a:null==Z?void 0:Z.prediction_date,u=null!=(n=null==(r=l[l.length-1])?void 0:r.prediction_date)?n:null==Z?void 0:Z.prediction_date;return{prediction:c&&u?"Estimare totală: ".concat(k(o)," pentru intervalul ").concat(R(c)," - ").concat(R(u),"."):"Estimare totală: ".concat(k(o),"."),confidence:"Medium",summary:"Modelul ".concat(null!=(s=null==d?void 0:d.name)?s:"selectat"," (").concat(null!=(i=null==d?void 0:d.version)?i:"v1",") a generat prognoza pe baza datelor dintre ").concat(R(U)," și ").concat(R(J),".")}},[V,Z,F,E,U,J]),ec=(0,n.useMemo)(()=>F.map(e=>{var r,t,a;return{date:R(e.prediction_date),forecast:Number(null!=(r=e.predicted_revenue)?r:0),lower:Number(null!=(t=e.lower_bound)?t:0),upper:Number(null!=(a=e.upper_bound)?a:0)}}),[F]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("header",{children:[(0,a.jsx)("h1",{className:"font-headline text-2xl",children:"Vanzari Asteptate (Prognoza AI)"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Utilizeaza AI pentru a prognoza performanta viitoare a vanzarilor pe baza datelor istorice."})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Prognoză v\xe2nzări"}),(0,a.jsxs)(x.BT,{children:["Selectează intervalul prognozei (maxim ",360," zile)."]})]}),(0,a.jsxs)(x.Wu,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-5 md:items-end",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{htmlFor:"train-from",children:"Training: de la"}),(0,a.jsx)(N.p,{id:"train-from",type:"date",value:U,onChange:e=>W(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{htmlFor:"train-to",children:"Training: p\xe2nă la"}),(0,a.jsx)(N.p,{id:"train-to",type:"date",value:J,onChange:e=>G(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{htmlFor:"forecast-from",children:"Prognoză: de la"}),(0,a.jsx)(N.p,{id:"forecast-from",type:"date",value:$,onChange:e=>H(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{htmlFor:"forecast-to",children:"Prognoză: p\xe2nă la"}),(0,a.jsx)(N.p,{id:"forecast-to",type:"date",value:K,onChange:e=>X(e.target.value)})]}),(0,a.jsx)(v.$,{type:"button",onClick:el,disabled:L,children:L?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Se actualizează..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Generează Prognoză"]})})]})]}),q&&(0,a.jsx)(x.Zp,{className:"border border-destructive/40 bg-destructive/5",children:(0,a.jsx)(x.Wu,{className:"py-4 text-sm text-destructive",children:q})}),P&&(0,a.jsx)(x.Zp,{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"mx-auto h-10 w-10 animate-spin"}),(0,a.jsx)("p",{className:"mt-4",children:"Se \xeencarcă modelele și prognozele disponibile..."})]})}),!P&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(x.Zp,{className:"bg-gradient-to-br from-primary/5 via-background to-background",children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 text-accent"}),(0,a.jsx)("span",{children:"Rezultate Prognoza"})]}),(0,a.jsxs)(x.BT,{children:["Ultimele predicții pentru orizontul de ",eo," zile."]})]}),(0,a.jsx)(x.Wu,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-[1.2fr_1fr]",children:[(0,a.jsxs)("div",{className:"space-y-2 rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Prognoza Principală"}),(0,a.jsxs)(b.E,{className:(0,y.cn)("text-primary-foreground",(e=>{switch(e){case"High":return"bg-green-500 hover:bg-green-500/90";case"Medium":return"bg-yellow-500 hover:bg-yellow-500/90";case"Low":return"bg-red-500 hover:bg-red-500/90";default:return"bg-muted"}})(null==ed?void 0:ed.confidence)),children:["\xcencredere: ",null!=(e=null==ed?void 0:ed.confidence)?e:"Medium"]})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-primary",children:null!=(r=null==ed?void 0:ed.prediction)?r:"Așteptăm rezultatele."})]}),(0,a.jsxs)("div",{className:"space-y-2 rounded-lg border bg-card p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Sumar Analiză"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:null!=(t=null==ed?void 0:ed.summary)?t:"Generează o prognoză pentru a vedea analiza detaliată."})]})]})})]}),F.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Grafic Prognoză V\xe2nzări"}),(0,a.jsx)(x.BT,{children:"Vizualizare a v\xe2nzărilor prognozate pe intervalul selectat."})]}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)(s.u,{width:"100%",height:300,children:(0,a.jsxs)(i.E,{data:ec,children:[(0,a.jsx)(l.d,{strokeDasharray:"3 3",vertical:!1}),(0,a.jsx)(o.W,{dataKey:"date",stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1}),(0,a.jsx)(d.h,{stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>"".concat(e/1e3,"k")}),(0,a.jsx)(c.m,{contentStyle:{backgroundColor:"hsl(var(--card))",borderColor:"hsl(var(--border))"},formatter:(e,r)=>["".concat(e.toLocaleString("ro-RO")," RON"),r]}),(0,a.jsx)(u.s,{wrapperStyle:{fontSize:"0.8rem"}}),(0,a.jsx)(m.yP,{dataKey:"forecast",name:"V\xe2nzări Prognozate",fill:"hsl(var(--chart-2))",radius:[4,4,0,0]})]})})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Detalii prognoză"}),(0,a.jsx)(x.BT,{children:"Lista predicțiilor pentru fiecare zi din interval."})]}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"text-xs uppercase text-muted-foreground",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-2 pr-4",children:"Dată"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Valoare prognozată"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Limită inferioară"}),(0,a.jsx)("th",{className:"py-2",children:"Limită superioară"})]})}),(0,a.jsx)("tbody",{children:F.map(e=>{var r,t,n;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-2 pr-4",children:R(e.prediction_date)}),(0,a.jsx)("td",{className:"py-2 pr-4 font-medium text-primary",children:k(Number(null!=(r=e.predicted_revenue)?r:0))}),(0,a.jsx)("td",{className:"py-2 pr-4",children:k(Number(null!=(t=e.lower_bound)?t:0))}),(0,a.jsx)("td",{className:"py-2",children:k(Number(null!=(n=e.upper_bound)?n:0))})]},e.id)})})]})})})]})]}):(0,a.jsxs)(x.Zp,{className:"flex flex-col items-center justify-center gap-4 py-16 text-center",children:[(0,a.jsx)(g.A,{className:"h-16 w-16 text-muted-foreground"}),(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Nu există prognoze \xeencă"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Generează o prognoză sau ajustează filtrele pentru a vedea date."})]})]})]})}},11647:(e,r,t)=>{"use strict";t.d(r,{E:()=>l});var a=t(95155);t(12115);var n=t(92885),s=t(64269);let i=(0,n.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)(i({variant:t}),r),...n})}},55039:(e,r,t)=>{Promise.resolve().then(t.bind(t,7216))},64269:(e,r,t)=>{"use strict";t.d(r,{cn:()=>s});var a=t(2821),n=t(75889);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,a.$)(r))}},65142:(e,r,t)=>{"use strict";t.d(r,{p:()=>i});var a=t(95155),n=t(12115),s=t(64269);let i=n.forwardRef((e,r)=>{let{className:t,type:n,...i}=e;return(0,a.jsx)("input",{type:n,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...i})});i.displayName="Input"},76444:(e,r,t)=>{"use strict";t.d(r,{J:()=>l});var a=t(95155),n=t(12115),s=t(32894),i=t(64269);let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.b,{ref:r,className:(0,i.cn)("text-sm font-medium leading-none",t),...n})});l.displayName=s.b.displayName},86948:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>i,aR:()=>l});var a=t(95155),n=t(12115),s=t(64269);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},90960:(e,r,t)=>{"use strict";t.d(r,{JR:()=>a,hD:()=>n,nr:()=>i,rP:()=>s});let a="https://powerful-spontaneity-production.up.railway.app";if(!a)throw Error("NEXT_PUBLIC_API_BASE_URL is not set.");class n extends Error{constructor(e,r,t){super(r),this.name="ApiError",this.status=e,this.body=t}}let s=async function(e){var r;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.startsWith("http://")||e.startsWith("https://")?e:new URL(e.startsWith("/")?e:"/".concat(e),a).toString(),s=new Headers(null!=(r=t.headers)?r:{});return t.body&&"string"==typeof t.body&&!s.has("Content-Type")&&s.set("Content-Type","application/json"),fetch(n,{...t,headers:s})},i=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=await s(e,r),a=await t.text();if(!t.ok){var i;throw new n(t.status,(i=t.status,401===i?"Unauthorized (401). Please sign in.":403===i?"Forbidden (403).":404===i?"Not Found (404).":i>=500?"Server error. Please try again later.":a||"Request failed (status ".concat(i,").")),a)}return a?JSON.parse(a):null}}},e=>{e.O(0,[4909,1171,2825,8441,1255,7358],()=>e(e.s=55039)),_N_E=e.O()}]);