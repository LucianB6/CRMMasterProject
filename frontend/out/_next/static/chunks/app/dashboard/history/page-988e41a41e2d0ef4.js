(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8610],{42903:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>Y});var s=a(95155),t=a(12115),r=a(26265),n=a(27105),o=a(68425),i=a(47734),u=a(73697),c=a(33420),d=a(73804),h=a(86948),m=a(87270),x=a(13406),g=a(15894),p=a(90960),v=a(10512),j=a(69141),f=a(89559),w=a(36100),b=a(1524),U=a(91761);let N={sales:{label:"V\xe2nzări",dataKey:"sales",unitLabel:"Unități",icon:v.A,showValue:!0,barName:"V\xe2nzări"},calls:{label:"Apeluri Făcute",dataKey:"calls",unitLabel:"Apeluri",icon:j.A,showValue:!1,barName:"Apeluri"},followUpSales:{label:"V\xe2nzări Follow-up",dataKey:"followUpSales",unitLabel:"Unități",icon:f.A,showValue:!1,barName:"V\xe2nzări Follow-up"},outboundBookings:{label:"Programări Outbound",dataKey:"outboundBookings",unitLabel:"Programări",icon:w.A,showValue:!1,barName:"Programări"}},y=new Set(["SUBMITTED","AUTO_SUBMITTED"]),T={last7Days:[],currentMonth:[],currentYear:[],previousYear:[]},C=e=>new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),S=(e,l)=>new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+l)),k=e=>e.toISOString().split("T")[0],D=e=>new Date("".concat(e,"T00:00:00Z")),A=e=>{var l,a,s,t,r,n,o;let i=e.inputs;return{sales:(null!=(l=i.sales_one_call_close)?l:0)+(null!=(a=i.followup_sales)?a:0)+(null!=(s=i.upsells)?s:0),calls:null!=(t=i.outbound_dials)?t:0,followUpSales:null!=(r=i.followup_sales)?r:0,outboundBookings:null!=(n=i.sales_call_booked_from_outbound)?n:0,value:null!=(o=i.contract_value)?o:0}},B=(e,l)=>{let a=new Map;return e.forEach(e=>{var s;if(!y.has(e.status))return;let t=D(e.reportDate);if(t.getUTCFullYear()!==l)return;let r=t.getUTCMonth(),n=null!=(s=a.get(r))?s:{sales:0,calls:0,followUpSales:0,outboundBookings:0,value:0},o=A(e);a.set(r,{sales:n.sales+o.sales,calls:n.calls+o.calls,followUpSales:n.followUpSales+o.followUpSales,outboundBookings:n.outboundBookings+o.outboundBookings,value:n.value+o.value})}),Array.from({length:12},(e,s)=>{var t,r,n,o,i;let u=(e=>{let l=e.toLocaleString("ro-RO",{month:"short"}).replace(".","");return l.charAt(0).toUpperCase()+l.slice(1)})(new Date(Date.UTC(l,s,1))),c=a.get(s);return{period:u,sales:null!=(t=null==c?void 0:c.sales)?t:0,calls:null!=(r=null==c?void 0:c.calls)?r:0,followUpSales:null!=(n=null==c?void 0:c.followUpSales)?n:0,outboundBookings:null!=(o=null==c?void 0:c.outboundBookings)?o:0,value:null!=(i=null==c?void 0:c.value)?i:0}})};function Y(){let{toast:e}=(0,g.dj)(),[l,a]=(0,t.useState)(T),[v,j]=(0,t.useState)(!0),f=(0,t.useCallback)(()=>window.localStorage.getItem("salesway_token"),[]),w=(0,t.useCallback)(async()=>{j(!0);try{let e=f(),l=e?{Authorization:"Bearer ".concat(e)}:void 0,s=C(new Date),t=new Date(Date.UTC(s.getUTCFullYear(),0,1)),r=new Date(Date.UTC(s.getUTCFullYear()-1,0,1)),n=new Date(Date.UTC(s.getUTCFullYear()-1,11,31)),[o,i,u,c]=await Promise.all([(0,p.nr)("/reports/daily/recent?days=7",{headers:l}),(0,p.nr)("/reports/daily/current-month",{headers:l}),(0,p.nr)("/reports/daily?from=".concat(k(t),"&to=").concat(k(s)),{headers:l}),(0,p.nr)("/reports/daily?from=".concat(k(r),"&to=").concat(k(n)),{headers:l})]),d=S(s,-6),h=new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),1)),m=new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth()+1,0));a({last7Days:((e,l,a,s)=>{let t=new Map;e.forEach(e=>{y.has(e.status)&&t.set(e.reportDate,A(e))});let r=[],n=C(l),o=C(a),i=C(s);for(;n<=o;){var u,c,d,h,m;let e=k(n),l=Math.round((i.getTime()-n.getTime())/864e5),a="".concat(l," zile");a=0===l?"Azi":1===l?"Ieri":"Acum ".concat(l," zile");let s=t.get(e);r.push({period:a,sales:null!=(u=null==s?void 0:s.sales)?u:0,calls:null!=(c=null==s?void 0:s.calls)?c:0,followUpSales:null!=(d=null==s?void 0:s.followUpSales)?d:0,outboundBookings:null!=(h=null==s?void 0:s.outboundBookings)?h:0,value:null!=(m=null==s?void 0:s.value)?m:0}),n=S(n,1)}return r})(o,d,s,s),currentMonth:((e,l,a)=>{let s=new Map;return e.forEach(e=>{var t;if(!y.has(e.status))return;let r=D(e.reportDate);if(r<l||r>a)return;let n=Math.floor((r.getUTCDate()-1)/7)+1,o=null!=(t=s.get(n))?t:{sales:0,calls:0,followUpSales:0,outboundBookings:0,value:0},i=A(e);s.set(n,{sales:o.sales+i.sales,calls:o.calls+i.calls,followUpSales:o.followUpSales+i.followUpSales,outboundBookings:o.outboundBookings+i.outboundBookings,value:o.value+i.value})}),Array.from({length:Math.ceil(a.getUTCDate()/7)},(e,l)=>{var a,t,r,n,o;let i=l+1,u=s.get(i);return{period:"Săpt. ".concat(i),sales:null!=(a=null==u?void 0:u.sales)?a:0,calls:null!=(t=null==u?void 0:u.calls)?t:0,followUpSales:null!=(r=null==u?void 0:u.followUpSales)?r:0,outboundBookings:null!=(n=null==u?void 0:u.outboundBookings)?n:0,value:null!=(o=null==u?void 0:u.value)?o:0}})})(i,h,m),currentYear:B(u,s.getUTCFullYear()),previousYear:B(c,s.getUTCFullYear()-1)})}catch(l){e({title:"Nu am putut \xeencărca istoricul",description:l instanceof Error?l.message:"Eroare necunoscută",variant:"destructive"})}finally{j(!1)}},[f,e]);(0,t.useEffect)(()=>{w()},[w]);let Y=(e,l,a)=>(0,s.jsxs)(x.tU,{defaultValue:"sales",className:"w-full",children:[(0,s.jsx)(x.j7,{className:"grid w-full grid-cols-2 sm:grid-cols-4",children:Object.keys(N).map(e=>(0,s.jsx)(x.Xi,{value:e,children:N[e].label},e))}),Object.keys(N).map(t=>(0,s.jsx)(x.av,{value:t,className:"mt-6",children:((e,l,a,t)=>{let x=N[a],g=((e,l)=>{let a=N[l].dataKey,s=e.reduce((e,l)=>e+(l[a]||0),0),t="sales"===l?e.reduce((e,l)=>e+(l.value||0),0):0,r=e.length>0?s/e.length:0;return{totalUnits:s,totalValue:t,averageUnits:r}})(l,a),p=x.icon;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,s.jsxs)(h.Zp,{children:[(0,s.jsxs)(h.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsxs)(h.ZB,{className:"text-sm font-medium",children:["Total (",x.unitLabel,")"]}),(0,s.jsx)(p,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:g.totalUnits})})]}),(0,s.jsxs)(h.Zp,{children:[(0,s.jsxs)(h.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(h.ZB,{className:"text-sm font-medium",children:"Medie / Perioadă"}),(0,s.jsx)(b.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:g.averageUnits.toFixed(1)})})]}),x.showValue&&(0,s.jsxs)(h.Zp,{children:[(0,s.jsxs)(h.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(h.ZB,{className:"text-sm font-medium",children:"Valoare Totală (RON)"}),(0,s.jsx)(U.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:g.totalValue>0?g.totalValue.toLocaleString("ro-RO"):"-"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,s.jsxs)(h.Zp,{children:[(0,s.jsx)(h.aR,{children:(0,s.jsx)(h.ZB,{children:"Grafic ".concat(x.label," - ").concat(e)})}),(0,s.jsx)(h.Wu,{children:(0,s.jsx)(r.u,{width:"100%",height:300,children:(0,s.jsxs)(n.E,{data:l,children:[(0,s.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,s.jsx)(i.W,{dataKey:"period",stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1}),(0,s.jsx)(u.h,{stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1,allowDecimals:!1}),(0,s.jsx)(c.m,{contentStyle:{backgroundColor:"hsl(var(--card))",borderColor:"hsl(var(--border))"}}),(0,s.jsx)(d.yP,{dataKey:x.dataKey,name:x.barName,fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}),(0,s.jsxs)(h.Zp,{children:[(0,s.jsx)(h.aR,{children:(0,s.jsx)(h.ZB,{children:"Tabel ".concat(x.label," - ").concat(e)})}),(0,s.jsx)(h.Wu,{children:(0,s.jsxs)(m.XI,{children:[(0,s.jsx)(m.A0,{children:(0,s.jsxs)(m.Hj,{children:[(0,s.jsx)(m.nd,{children:t}),(0,s.jsxs)(m.nd,{className:"text-right",children:[x.label," (",x.unitLabel,")"]}),x.showValue&&(0,s.jsx)(m.nd,{className:"text-right",children:"Valoare (RON)"})]})}),(0,s.jsx)(m.BF,{children:l.map(e=>(0,s.jsxs)(m.Hj,{children:[(0,s.jsx)(m.nA,{className:"font-medium",children:e.period}),(0,s.jsx)(m.nA,{className:"text-right",children:e[x.dataKey]}),x.showValue&&(0,s.jsx)(m.nA,{className:"text-right",children:(e.value||0).toLocaleString("ro-RO")})]},e.period))})]})})]})]})]})})(e,l,t,a)},t))]});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{className:"font-headline text-2xl",children:"Istoric V\xe2nzări & Activitate"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Analizează performanța ta pe diferite perioade de timp."})]}),v?(0,s.jsx)("div",{className:"rounded-lg border border-dashed p-6 text-sm text-muted-foreground",children:"Se \xeencarcă istoricul..."}):(0,s.jsxs)(x.tU,{defaultValue:"7days",className:"w-full",children:[(0,s.jsxs)(x.j7,{className:"grid w-full grid-cols-2 sm:grid-cols-4",children:[(0,s.jsx)(x.Xi,{value:"7days",children:"Ultimele 7 zile"}),(0,s.jsx)(x.Xi,{value:"currentMonth",children:"Luna curentă"}),(0,s.jsx)(x.Xi,{value:"currentYear",children:"Anul curent"}),(0,s.jsx)(x.Xi,{value:"previousYear",children:"Anul precedent"})]}),(0,s.jsx)(x.av,{value:"7days",className:"mt-6",children:Y("Ultimele 7 zile",l.last7Days,"Ziua")}),(0,s.jsx)(x.av,{value:"currentMonth",className:"mt-6",children:Y("Luna Curentă",l.currentMonth,"Săptăm\xe2na")}),(0,s.jsx)(x.av,{value:"currentYear",className:"mt-6",children:Y("Anul Curent",l.currentYear,"Luna")}),(0,s.jsx)(x.av,{value:"previousYear",className:"mt-6",children:Y("Anul Precedent",l.previousYear,"Luna")})]})]})}},72926:(e,l,a)=>{Promise.resolve().then(a.bind(a,42903))}},e=>{e.O(0,[4909,1171,4964,1276,8441,1255,7358],()=>e(e.s=72926)),_N_E=e.O()}]);